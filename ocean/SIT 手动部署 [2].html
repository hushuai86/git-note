<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-89251297-87e0-425d-8f38-65419805df1d"></attachment><h1>SIT 手动部署SIT 手动部署</h1><p>helm 添加 Repo 命令</p><p>helm repo add accentrix http://192.168.118.219/nexus/repository/helm-release/ --username admin --password admin123</p><p><br></p><p>SIT部署</p><p>#ssh to 192.168.118.180</p><p><br></p><p>cd /root/projects/ocean/</p><p><br></p><p>#更新代码</p><p><span style="color: rgb(51, 51, 51);">git pull&nbsp;</span></p><p><br></p><p><span style="color: rgb(51, 51, 51);">#maven 打包</span></p><p><span style="color: rgb(51, 51, 51);">mvn clean package -Dmaven.test.skip=true&nbsp;-Pnttca</span></p><p><br></p><p><span style="color: rgb(51, 51, 51);">#进入你想要部署的project目录下</span></p><p>例： cd&nbsp;&nbsp;kafka-connect</p><p>#以下命令要在各个需要被部署的子模块的目录下运行</p><p><br></p><p>#build docekr 镜像</p><p>docker build -t&nbsp;device-service&nbsp;.</p><p>#打tag，用于后面push到私有库</p><p>docker tag device-service:latest 192.168.130.148:5000/operator-portal/device-service:latest</p><p><br></p><p>#上面两步可以合并成一步</p><p>docker build -t 192.168.130.148:5000/operator-portal/kafka-producer:latest .</p><p><br></p><p>#docker build -t kafka-connect-sink .</p><p><br></p><p>#登录私有库</p><p>docker login -u admin -p admin123 192.168.130.148:5000</p><p><br></p><p>#push 最新的镜像到私有库</p><p>docker push 192.168.130.148:5000/operator-portal/kafka-producer:latest</p><p><br></p><p>cd helm</p><p><br></p><p>#打包helm</p><p>helm package kafka-producer-chart/</p><p><br></p><p>#把打包后的helm 包上传到 nexus</p><p>curl -u admin:admin123 http://192.168.118.219/nexus/repository/helm-release/ --upload-file kafka-connect-sink-chart-0.1.0.tgz -v</p><p><br></p><p>#更新 helm repository</p><p>helm repo update</p><p><br></p><p>#获取最后一次提交的commitId，后面有用到</p><p>git log -1 --pretty=format:"%h"</p><p><br></p><p><span style="color: rgb(51, 51, 51);">#uninstall 之前的 helm</span> ,注意需要指定namespace ，uninstall之后 k8s会自动删除对应的deployment</p><p>helm uninstall kafka-connect-sink -n ocean</p><p><br></p><p>#install helm install之后 k8s会自动部署对应的deployment</p><p>helm&nbsp;upgrade --install \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set env=sit \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set gitCommitId=14f837eb \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set imagePullSecrets[0].name=docker-registry \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set image.registry=192.168.130.148:5000 \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set image.namespace=operator-portal \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set service.name=kafka-connect-sink \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;--set service.version='latest' \</p><p>&nbsp;&nbsp;&nbsp;&nbsp;-n ocean \</p><p>&nbsp;&nbsp;kafka-connect-sink&nbsp;accentrix/kafka-connect-sink-chart</p><p><br></p>